unit RobertPATmain_u;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Data.Win.ADODB, Vcl.Grids,
  Vcl.DBGrids, Vcl.ComCtrls, Vcl.StdCtrls, Vcl.ExtCtrls, Vcl.Mask,
  Vcl.Imaging.jpeg, Vcl.Buttons, Vcl.Menus, Vcl.Samples.Spin, Vcl.MPlayer,
  Vcl.AppAnalytics, Winapi.WebView2, Winapi.ActiveX, Vcl.Edge, Vcl.OleCtrls,
  SHDocVw, Vcl.ColorGrd, Vcl.BaseImageCollection, Vcl.ImageCollection,
  Vcl.WinXCalendars, Vcl.WinXCtrls, Vcl.Touch.Keyboard, Vcl.JumpList,
  Vcl.ActnMan, Vcl.ActnColorMaps, IdBaseComponent, IdComponent, IdTCPConnection,
  IdTCPClient, IdExplicitTLSClientServerBase, IdMessageClient, IdIMAP4,
  Vcl.DBCtrls, Vcl.CheckLst, Soap.InvokeRegistry, Soap.WSDLIntf,
  Soap.SOAPPasInv, Soap.SOAPHTTPPasInv, VclTee.TeeGDIPlus, VCLTee.TeEngine,
  VCLTee.Series, VCLTee.TeeProcs, VCLTee.Chart, DateUtils, math, clsDistance_u, clsUsername_u,
  Vcl.FileCtrl;

type
  TfrmVolitant_Express = class(TForm)
    conDB: TADOConnection;
    tblCompany: TADOTable;
    dsrCompany: TDataSource;
    qrySQL: TADOQuery;
    dsrSQL: TDataSource;
    tblItems: TADOTable;
    tblOrders: TADOTable;
    tblPlanes: TADOTable;
    dsrItems: TDataSource;
    dsrOrders: TDataSource;
    dsrPlanes: TDataSource;
    pgcMain: TPageControl;
    tsRegister: TTabSheet;
    tsLogin: TTabSheet;
    pgcRegister: TPageControl;
    tsDetails: TTabSheet;
    tsContact: TTabSheet;
    lblWelcome: TLabel;
    btnRegisterGO: TButton;
    btnLoginGO: TButton;
    tsLastInfo: TTabSheet;
    grbMoreInfo: TGroupBox;
    btnIntroVid: TButton;
    btnAboutUs: TButton;
    btnGallery: TButton;
    btnRegBack: TButton;
    btnLoginBack: TButton;
    lblRegister: TLabel;
    pnlCdetails: TPanel;
    lblCname: TLabel;
    edtCName: TEdit;
    lblCreatePassword: TLabel;
    edtCreatePassword: TEdit;
    lblConfirmPass: TLabel;
    edtConfirmPass: TEdit;
    chkGovernment: TCheckBox;
    imgRegPlane: TImage;
    imgBasedFlag: TImage;
    cmbCountryBased: TComboBox;
    BitBtnTOcInfo: TBitBtn;
    pnlRegContact: TPanel;
    lblRegEmail: TLabel;
    edtRegEmail: TEdit;
    chkNewsLetter: TCheckBox;
    tsRegConfirm: TTabSheet;
    pnlLastRegInfo: TPanel;
    dtpEstablishedDate: TDateTimePicker;
    lblEstabDate: TLabel;
    lblRegDefaultHours: TLabel;
    sedRegDefaultHours: TSpinEdit;
    imgRegEarth: TImage;
    BitBtnRegister: TBitBtn;
    redConfirmRegInfo: TRichEdit;
    lblConfirmReg: TLabel;
    btnRegRestart: TButton;
    tsIntroVideo: TTabSheet;
    tsGallery: TTabSheet;
    mpIntroVideo: TMediaPlayer;
    pnlVideo: TPanel;
    lblIntroVid: TLabel;
    lblGallery: TLabel;
    tsAdmin: TTabSheet;
    pgcAdmin: TPageControl;
    lblLogin: TLabel;
    tsItemsAdmin: TTabSheet;
    tsPlanesAdmin: TTabSheet;
    grbAdminQuick: TGroupBox;
    tsOrdersAdmin: TTabSheet;
    tsCompaniesAdmin: TTabSheet;
    btnToItems: TButton;
    btnToPlanes: TButton;
    btnToOrders: TButton;
    btnToCompanies: TButton;
    tsHome: TTabSheet;
    tsEmailsAdmin: TTabSheet;
    btnToEmails: TButton;
    lblUsernameLogin: TLabel;
    edtUsernameLogin: TEdit;
    edtPasswordLogin: TEdit;
    lblPasswordLogin: TLabel;
    btnLogin: TButton;
    tsCustomAdmin: TTabSheet;
    btnToSummary: TButton;
    grbHome: TGroupBox;
    tsPayment: TTabSheet;
    tsPOrder: TTabSheet;
    tsManageCompany: TTabSheet;
    tsLog: TTabSheet;
    btnTOorder: TButton;
    btnTOLog: TButton;
    btnTOpayment: TButton;
    btnManageCompany: TButton;
    lblGenUsername: TLabel;
    edtGUsername: TEdit;
    lblPasswordConfirm: TLabel;
    pnlConfirmPass: TPanel;
    lblConfirmAge: TLabel;
    sedCompanyAgeConfirm: TSpinEdit;
    lblConfirmOther: TLabel;
    btnPlayVid: TButton;
    btnPauseVid: TButton;
    btnRestartVid: TButton;
    BitBtnBackTOWelcomeFromVid: TBitBtn;
    imgVPLeft: TImage;
    imgVPRight: TImage;
    lblOrder: TLabel;
    lblItemsAdmin: TLabel;
    dbgSQL_admin: TDBGrid;
    edtCustomSQL: TEdit;
    lblCustomSQL: TLabel;
    btnCustomSQL: TButton;
    grbAddItem: TGroupBox;
    edtItemAddName: TEdit;
    cmbItemCategoryAdd: TComboBox;
    chkDangerousItemAdd: TCheckBox;
    redAddDescription: TRichEdit;
    lblAddItemName: TLabel;
    lblAddItemCategory: TLabel;
    btnAddCategoty: TButton;
    lblAddTransportItemPrice: TLabel;
    lblAddItemDescription: TLabel;
    btnAddItem: TButton;
    grbManageItems: TGroupBox;
    pgcOrder: TPageControl;
    tsPlaceOrder: TTabSheet;
    tsOrderSummary: TTabSheet;
    tsAdminSum: TTabSheet;
    lblAdminSum: TLabel;
    grbAddPlane: TGroupBox;
    lblManagePlanes: TLabel;
    grbManagePlanes: TGroupBox;
    ListBox1: TListBox;
    lstSelectItemManage: TListBox;
    lblSelectItemTomanage: TLabel;
    btnRetireItem: TButton;
    redUpdateItem: TRichEdit;
    btnUpdateItem: TButton;
    lblUpdateItemInfo: TLabel;
    sedAddItemRands: TSpinEdit;
    sedItemAddCents: TSpinEdit;
    lblAddRands: TLabel;
    lblAddCents: TLabel;
    lblUpdateItemPrice: TLabel;
    sedUpdateItemRands: TSpinEdit;
    sedUpdateItemCents: TSpinEdit;
    lblUpdateItemRands: TLabel;
    lblUpdateItemCents: TLabel;
    edtAddPlaneName: TEdit;
    sedAddPlaneMLoad: TSpinEdit;
    sedAddPlaneCSpeed: TSpinEdit;
    sedAddFuelRands: TSpinEdit;
    sedAddFuelCents: TSpinEdit;
    sedAddPlaneMDistance: TSpinEdit;
    btnAddPlane: TButton;
    lblAddNameOfPlane: TLabel;
    lblAddPlaneMaxLoad: TLabel;
    lblAddPlaneCruiseSpeed: TLabel;
    lblAddPlaneDistance: TLabel;
    lblPlaneAddFeulCosr: TLabel;
    lblAddFuelRand: TLabel;
    lblAddFuelCents: TLabel;
    lblUpdateFuelPrice: TLabel;
    chkRetirePlane: TCheckBox;
    sedUpdateFuelRands: TSpinEdit;
    sedUpdateFuelCents: TSpinEdit;
    lblUpdateFuelRands: TLabel;
    lblUpdateFuelCents: TLabel;
    ListBox2: TListBox;
    lblSelectPlaneUpdate: TLabel;
    btnUpdatePlane: TButton;
    cmbSelectTable: TComboBox;
    dbgDifferentTables: TDBGrid;
    grbSelectTable: TGroupBox;
    grbTableTotal: TGroupBox;
    pnlTotalAccounts: TPanel;
    pnlTotalOrders: TPanel;
    pnlTotalItems: TPanel;
    pnlTotalPlanes: TPanel;
    btnReloadSum: TButton;
    grbStatistics: TGroupBox;
    lblTopPlain: TLabel;
    lblTopItem: TLabel;
    lblTotalRevenue: TLabel;
    lblTopPickupC: TLabel;
    lblTopDropOffC: TLabel;
    lblAverageWeight: TLabel;
    grbProgress: TGroupBox;
    PBrevenue: TProgressBar;
    PBOrders: TProgressBar;
    lblRevenueProgress: TLabel;
    lblOrdersManagedProgress: TLabel;
    lblCustomSQLPage: TLabel;
    sbGallery: TScrollBox;
    btnToCustom: TButton;
    chkConfirmRegInfo: TCheckBox;
    tsWelcome: TTabSheet;
    imgLogo_2: TImage;
    imgLogo_1: TImage;
    lblAdminOrders: TLabel;
    grpUpdateOrder: TGroupBox;
    lstSelectOrderAdmin: TListBox;
    pgcAdminOrders: TPageControl;
    tsOrderUpdate: TTabSheet;
    tsOrderOutput: TTabSheet;
    redOrderOut: TRichEdit;
    btnOrderSumAdmin: TButton;
    btnOrderInfoAdmin: TButton;
    btnOrdersOutstandingPayment: TButton;
    btnOrderPhaseAdmin: TButton;
    cmbOrderPhaseSearch: TComboBox;
    edtCompanyNameSearchOrders: TEdit;
    lblCompanyNameToSearch: TLabel;
    btnSearchForOrders: TButton;
    BitBtnClearOrderSearch: TBitBtn;
    lblSelectOrderStatus: TLabel;
    rgpOrderStatus: TRadioGroup;
    btnUpdateOrderStatus: TButton;
    lblManageCompanies: TLabel;
    btnToOrdersOutput: TButton;
    btnTOorderUpdate: TButton;
    redCompanyOut: TRichEdit;
    btnCompanyOrderOut: TButton;
    btnSeatchForCompany: TButton;
    btnSearcCompAgeRange: TButton;
    edtEnterSearchCompanyt: TEdit;
    sedAgeBottomSearch: TSpinEdit;
    sedAgeTopSearch: TSpinEdit;
    lblSearchForComanyAge: TLabel;
    lblAgeBottom: TLabel;
    lblTopAge: TLabel;
    lblSendEmails: TLabel;
    grbNewsLetter: TGroupBox;
    memNewsLetterMessage: TMemo;
    btnSendNewsletter: TButton;
    lblWelcomeHome: TLabel;
    btnCInfoBack: TButton;
    btnLastInfoBack: TButton;
    bitbtnCloseProgram: TBitBtn;
    btnBackFromGallery: TButton;
    bitbtnRegHelp: TBitBtn;
    bitbtnLoginHelp: TBitBtn;
    bitbtnAdminHelp: TBitBtn;
    bitBtnHomeHelp: TBitBtn;
    lblPayment: TLabel;
    lstPayment: TListBox;
    lblSelectOrderToPay: TLabel;
    BitBtnPay: TBitBtn;
    redPaymentConfirm: TRichEdit;
    btnBackHomeFromPay: TButton;
    BitBtnPaymentHelp: TBitBtn;
    BitBtnretryPaySelect: TBitBtn;
    BitBtnNextToLastInfo: TBitBtn;
    BitBtnNextToConfirm: TBitBtn;
    pnlFlightAnimation: TPanel;
    imgPlaneAnimation: TImage;
    tFlightAnimation: TTimer;
    lblSelectCountry: TLabel;
    lblGalleryInfo: TLabel;
    lblConfirmYears: TLabel;
    procedure FormActivate(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure btnRegisterGOClick(Sender: TObject);
    procedure btnLoginGOClick(Sender: TObject);
    procedure btnIntroVidClick(Sender: TObject);
    procedure btnAboutUsClick(Sender: TObject);
    procedure btnGalleryClick(Sender: TObject);
    procedure btnRegBackClick(Sender: TObject);
    procedure btnLoginBackClick(Sender: TObject);
    procedure BitBtnTOcInfoClick(Sender: TObject);
    procedure cmbCountryBasedChange(Sender: TObject);
    procedure BitBtnRegisterClick(Sender: TObject);
    procedure btnRegRestartClick(Sender: TObject);
    procedure btnLoginClick(Sender: TObject);
    procedure btnTOorderClick(Sender: TObject);
    procedure btnPlayVidClick(Sender: TObject);
    procedure btnPauseVidClick(Sender: TObject);
    procedure btnRestartVidClick(Sender: TObject);
    procedure BitBtnBackTOWelcomeFromVidClick(Sender: TObject);
    procedure btnCustomSQLClick(Sender: TObject);
    procedure btnAddCategotyClick(Sender: TObject);
    procedure btnAddItemClick(Sender: TObject);
    procedure btnRetireItemClick(Sender: TObject);
    procedure lstSelectItemManageClick(Sender: TObject);
    procedure btnUpdateItemClick(Sender: TObject);
    procedure btnUpdatePlaneClick(Sender: TObject);
    procedure dbgDifferentTablesCellClick(Column: TColumn);
    procedure btnReloadSumClick(Sender: TObject);
    procedure cmbSelectTableChange(Sender: TObject);
    procedure btnToCustomClick(Sender: TObject);
    procedure btnOrderPhaseAdminClick(Sender: TObject);
    procedure btnToOrdersOutputClick(Sender: TObject);
    procedure btnTOorderUpdateClick(Sender: TObject);
    procedure btnCompanyOrderOutClick(Sender: TObject);
    procedure btnSendNewsletterClick(Sender: TObject);
    procedure btnTOLogClick(Sender: TObject);
    procedure btnTOpaymentClick(Sender: TObject);
    procedure btnManageCompanyClick(Sender: TObject);
    procedure bitbtnCloseProgramClick(Sender: TObject);
    procedure btnBackFromGalleryClick(Sender: TObject);
    procedure BitBtnNextToConfirmClick(Sender: TObject);
    procedure btnCInfoBackClick(Sender: TObject);
    procedure BitBtnNextToLastInfoClick(Sender: TObject);
    procedure btnLastInfoBackClick(Sender: TObject);
    procedure tFlightAnimationTimer(Sender: TObject);
    procedure btnToSummaryClick(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure btnToEmailsClick(Sender: TObject);
    procedure btnToItemsClick(Sender: TObject);

  private
    { Private declarations }

    // Class declaration
    objDistance : TDistance ;
    objUsername : TUsername ;

    Function ValidateEmail(pEmail: string): Boolean;


    Procedure imgDynamicOnclick(Sender: TObject);    // For the dynamic object
    
  public
    { Public declarations }


  // Array declaration

    arrCountryName,  arrCountryCode : array[1..245] of string;
    arrLatitude, arrLongitude : array[1..245] of real ;

    arrSpecialCharacters : array[1..32] of char;

  // Variable declararion
  sID : string ;
  iCountryCount,  iSpecialCharacterCount : integer ;
  bTimer : boolean;

    // For the gallery
   iImageCount : integer;
  arrFileNames : array[1..1000] of string;
 

  end;

var
  frmVolitant_Express: TfrmVolitant_Express;
  imgDynamicGallery : TImage ;

implementation

{$R *.dfm}

procedure TfrmVolitant_Express.bitbtnCloseProgramClick(Sender: TObject);
begin
// Closes/ ends the program
end;

procedure TfrmVolitant_Express.BitBtnBackTOWelcomeFromVidClick(Sender: TObject);
begin
// Go back to the welcome page from the watch video page
mpIntroVideo.Stop;     // Stop the video

// Change pages
tsIntroVideo.TabVisible := false;
tsWelcome.TabVisible:= True ;

end;


procedure TfrmVolitant_Express.BitBtnNextToConfirmClick(Sender: TObject);
var
  bUsernameFound : boolean;
  sUsernameCreated : string;
begin
    // go to the reg confirmation page from the last info page
      redConfirmRegInfo.Clear ;
     // Check to make sure that the date of the companies establishment is in the past and NOT in the furure

     if dtpEstablishedDate.Date > date then
     begin
       ShowMessage('Invalid date of establishment') ;
      Exit;
     end;


     // Fill the fields on the registration page

     pnlConfirmPass.Caption := 'You Password: ' + edtCreatePassword.Text ;
     sedCompanyAgeConfirm.Value := YearsBetween(date, dtpEstablishedDate.Date) ;

     // Richedit
     //Government agency
     if chkGovernment.Checked then
     redConfirmRegInfo.Lines.Add('Government Agency: YES')
     else
      redConfirmRegInfo.Lines.Add('Government Agency: NO') ;
   //Country based
    redConfirmRegInfo.Lines.Add('Country Based: '+ cmbCountryBased.Items[cmbCountryBased.ItemIndex]);
    // Email
     redConfirmRegInfo.Lines.Add('Email: '+ edtRegEmail.Text) ;
     // NEwsletter
     if chkNewsLetter.Checked then
      redConfirmRegInfo.Lines.Add('Newsletter: YES' )
      else
       redConfirmRegInfo.Lines.Add('Newsletter: NO');
      // Defualt hours
       redConfirmRegInfo.Lines.Add('Defualt Hours: ' + IntToStr(sedRegDefaultHours.Value) );

     tsLastInfo.TabVisible := False ;
     tsRegConfirm.TabVisible := True;

    // Inisiate the username class
    objUsername := TUsername.Create(edtCName.Text , cmbCountryBased.Items[cmbCountrybased.ItemIndex],dtpEstablishedDate.Date );

    sUsernameCreated := objUsername.ToString ;
    edtGUsername.Text := sUsernameCreated ;
    
    // Check to make sure that the username does not exist. (IT can be possible, as you cant register a company twice, however, a company starting with the same word can technically generate twice )
    repeat
      bUsernameFound := False;
      tblCompany.First ;
      while not tblCompany.eof do
      begin
        if tblCompany['Username'] = sUsernameCreated then // Check for a duplicate username
        begin
          sUsernameCreated := Copy(sUsernameCreated ,1, Pos('_', sUsernameCreated) ); // Just keep everything beforee the uudnerscore
          bUsernameFound := True; // Change to true as the username has been found
          sUsernameCreated := sUsernameCreated + IntToStr(RandomRange(1, 1000) ) ;   // Generate a new random number for after the undersocre

            objUsername.SetUsername(sUsernameCreated) ; // Update the username to the object
            break; // exit the loop to save time
        end;
        tblCompany.Next ;
      end;
      
    until bUsernameFound = False; // If no duplicate username was found, then no need to check again
    
end;

procedure TfrmVolitant_Express.BitBtnNextToLastInfoClick(Sender: TObject);
var
  sEmail : string ; 
  I, iPointPos, iATcount : integer ;
  bPoint: boolean;
begin
// Go to the Last info reg page from the contact details reg page
    sEmail := edtRegEmail.Text ;
  // Validation
 if not  ValidateEmail(sEmail) then // if the email was not correct then exit the program
 exit;

 tsContact.TabVisible := False ;
 tsLastInfo.TabVisible := True ;
 
end;

procedure TfrmVolitant_Express.BitBtnRegisterClick(Sender: TObject);
var
  sCName, sCRegPassword, sUsernameGenerated, sRegEmail, sLocationBasedReg: string;
  bGovernment, bNewsLetter : boolean;
  dDateEnstablished, dRegDate : tDate;
  iDefaultHours : integer ;
begin
// register the company

  //Confirmation
  if chkConfirmRegInfo.Checked = false then
  begin
    ShowMessage('You need to confirm that the provided info is true!');
    Exit;
  end;


  // Read values into variables
  sCName := edtCName.Text ;
  sCRegPassword := edtCreatePassword.Text ;
  sUsernameGenerated := objUsername.GetUsername ;
  sRegEmail := edtRegEmail.Text ;

   //Government agency
     if chkGovernment.Checked then
      bGovernment := True
     else
      bGovernment := false;

   dDateEnstablished := dtpEstablishedDate.Date;

   sLocationBasedReg := cmbCountryBased.Items[cmbCountryBased.ItemIndex];


    // NEwsletter
     if chkNewsLetter.Checked then
    bNewsLetter := true
      else
    bNewsLetter := False;

    dRegDate := Date;

    iDefaultHours := sedRegDefaultHours.Value ;

// Write to the db

  tblCompany.Insert ;

  tblCompany['CompanyName']:= sCName;
  tblCompany['Password'] := sCRegPassword ;
  tblCompany['Username']:= sUsernameGenerated ;
  tblCompany['Email']:= sRegEmail ;
  tblCompany['Goverment Agency']:= bGovernment ;
  tblCompany['RegDate'] := dRegDate ;
  tblCompany['Location Based'] := sLocationBasedReg ;
  tblCompany['Newsletter'] := bNewsLetter ;
  tblCompany['Establishment Date'] := dDateEnstablished ;
  tblCompany['Defualt Hours'] := iDefaultHours ;

  tblCompany.Post ;

// Go to the Home page
end;

procedure TfrmVolitant_Express.BitBtnTOcInfoClick(Sender: TObject);
var
  sName, sPassword: string ;
  I: Integer;
  cChar, c : char;
  bErrorCharacter, bNumber, bCapital, bSpecialCharacter : boolean ;
begin
// Go to the next page of register; the Contact Info page

    sName := edtCName.Text ;
    sPassword := edtCreatePassword.Text ;
   // Validation

   // Company Name
   if (sName = '') or (sName = ' ') then
   begin
     ShowMessageUser('Please enter your Company Name') ;
     Exit;
   end;
   // Range Check
   if not ((Length(sName) >=1) and (Length(sName) <= 30 )) then
   begin
     ShowMessage('Company Name Length should be between 1 and 30 characters');
     Exit;
   end;
   // Last character may not be a space
   if sName[Length(sName) ] = ' ' then
   begin
     ShowMessage('The last character of the name may not be a space');
     exit; 
   end;
    // Check that the Company Name does not contain any elegal characters
   for I := 1 to Length(sName)  do
    begin
      if not ((sName[i] in ['A'..'Z']) or (sName[i] in ['a'..'z']) or (sName[i] in ['$', '-', ',', '.', '''', ' ']) or (sName[i] in ['0'..'9'])) then
      begin
        ShowMessage('Only alphabet characters, spaces and these special characters are allowed in the Name: '+ #13+ '$ - , . ''');
        Exit;
      end;
      
    end;

    // Check that the Company Name does not already exist (Check that the company has not been registered )
    tblCompany.first;
    while not tblCompany.Eof do
    begin
      if UpperCase(sName) = Uppercase(tblCompany['CompanyName'])  then
      begin
        ShowMessage('Company Already Registered.');
        Exit; 
      end;
    
      tblCompany.Next ;
    end;    

    // CountryBased. Make sure that a country was entered
    if cmbCountryBased.ItemIndex = -1 then
    begin
      ShowMessage('Please Select/Enter a valid Country');
      Exit; 
    end;
    
   // Password

   bNumber := False;
   bCapital := false;
   bSpecialCharacter := False;
   
   // Check that the password is in range
    if not ((Length(sPassword) >= 6) and (Length(sPassword) <= 20 )) then
    begin
      ShowMessage('Password Should be between 6 and 20 character long.');
      exit;
    end;
    // Check that the password is a valid passowrd
    for cChar  in sPassword  do
    begin

       bErrorCharacter := true;
      for c in arrSpecialCharacters do    // Checks that all the characters are valid
      begin
          if  (cChar = c) or (cChar in ['A'..'Z']) or (cChar in ['a'..'z']) or (cChar in ['0'..'9']) then
          begin
          bErrorCharacter := False ;
          break;     // exit the loop but not the procedure. Performance
          end

      end;

      if bErrorCharacter = true then
      begin
        ShowMessage('Invalid/Unsupported character in Password'+#13+'(Spaces are not allowed)')  ;
        exit;
      end ;
    

      // Check that password is secure
      if cChar in ['0'..'9'] then
      bNumber := True ;

      if cChar in ['A'..'Z'] then
       bCapital := True;

        if bSpecialCharacter = false then
        begin
            for c in arrSpecialCharacters  do
            begin
               if cChar = c then
               begin
               bSpecialCharacter := true ;

               break ;   // exit the loop but not the procedure.Performance
               end;

            end;
        end;
    
    end;
    // Password secure dialogue
    if not (bNumber = true and bCapital = true and bSpecialCharacter = true) then
    begin
      ShowMessage('Password does not meet the requirement.'+#13+'Password should contain atleast 1:'+#13+'-Special character'+#13+'-Capital Letter'+#13+'-Number');
      exit;
    end;
    // Make sure that you have entered the password that you think you have
    if not (sPassword = edtConfirmPass.Text ) then
    begin
      ShowMessage('Password do not match' )  ;
      exit;
    end;

   tsDetails.TabVisible := False;
   tsContact.TabVisible := True ;   
end;

procedure TfrmVolitant_Express.btnAboutUsClick(Sender: TObject);
begin
// Gives some background information about the company
// showmess
end;

procedure TfrmVolitant_Express.btnAddCategotyClick(Sender: TObject);
var
  sCategoryAdd, sLine : string ;
  tFile : TextFile ;
begin
// Add an item category

  sCategoryAdd := InputBox('Please type the category you would like to add:','*No duplicates allowed','') ;
  // Check that a category was entered
  if (sCategoryAdd = '') or (sCategoryAdd = ' ') then
  begin
    ShowMessage('No category entered');
    exit;
  end;
  // Check that the category is in Range
  if Length(sCategoryAdd) > 40  then
  begin
      ShowMessage('Category should be shorter or equel to 40 characters');
    exit;
  end;
// Check that the category does not exit already
    AssignFile(tFile, 'Item_Categories.txt');

  if not FileExists('Item_Categories.txt')  then  // Check that the file exists
  begin
    ShowMessage('Item_Categories.txt not Found, created');
    Rewrite(Tfile)  ;
  end;
  Reset(tFile) ;
     // Search for categories
  while not Eof(tfile)  do
  begin
    Readln(tFile, sLine) ;

    if UpperCase(sLine) = UpperCase(sCategoryAdd)   then // If the category already exists
    begin
      ShowMessage('Category already exists!') ;
      CloseFile(tFile) ;
      Exit;
    end;
  end;

  // Add item t otxt file if category does not exist
  Append(tFile);
  Writeln(tFile, sCategoryAdd) ;

  CloseFile(tFile);
  ShowMessage('Item added to combobox') ;
// Update the combobox in the end when the category has been added
cmbItemCategoryAdd.Items.Add(sCategoryAdd) ;
end;

procedure TfrmVolitant_Express.btnAddItemClick(Sender: TObject);
var
  sItemname : string;
  rPrice : real;
  bDangerous : boolean;
begin
// Add a new item to the Items table

// Validation

   // Check that a new item name was entered and that it is in range
   sItemname := edtItemAddName.Text ;
   if (sItemname = '') or (sItemname = ' ') or (Length(sItemname) > 40 ) then
   begin
      ShowMessage('No item name entered or length longer than 40 character') ;
      exit;
   end;
  // Check that the item name does not already exist
  tblItems.First ;
  while not tblItems.Eof do
  begin
    if Uppercase(sItemName) = Uppercase(tblItems['Item Name']) then
    begin
      ShowMessage('Item already exists. Update item to change anything') ;
      exit;
    end;

    tblItems.Next ;
  end;

  // Check that category is selected
  if cmbItemCategoryAdd.ItemIndex = -1 then
  begin
    ShowMessage('Please select item category') ;
    exit;
  end;

  // Check that a price is entered
  if not sedAddItemRands.Value = 0 then
  begin
    ShowMessage('Enter the cost per kg for the item in Rands');
    exit;
  end;

// Remember to also validate that the description entered is shorted than the amount of characters that is allowed in that field in the db (120 at this time of writing)
  if Length(redAddDescription.Text) > 120  then
  begin
    ShowMessage('Item description should not exeed a length of 120 characters. (Currently: '+IntToStr(length(redAddDescription.Text)) +')');
    exit;
  end;

  // Add item to the database
  if chkDangerousItemAdd.Checked then
  bDangerous := true
  else
  bDangerous := False;


  rPrice :=sedAddItemRands.Value + (sedItemAddCents.Value  * 0.01);
{ qrySQL.SQL.Text := 'INSERT INTO tblItems (Item Name, Category, T_Cost/kg, Dangerous, Note, Retired) VALUES ('+QuotedStr(sItemname)+','+ QuotedStr(cmbItemCategoryAdd.Items[cmbItemCategoryAdd.ItemIndex]) +','+ FloatToStr(rPrice)+',' + BoolToStr(bDangerous) +','+ quotedStr(redAddDescription.Text)+','+ 'False' + ')';
  qrySQL.ExecSQL ;  }

  tblItems.Insert ;
   tblItems['Item Name'] := sItemname ;
   tblItems['Category']:= cmbItemCategoryAdd.Items[cmbItemCategoryAdd.ItemIndex];
   tblItems['T_Cost/kg'] := rPrice;
   tblItems['Dangerous']  := bDangerous ;
   tblItems['Note']:= redAddDescription.Text ;
   tblItems['Retired'] := False;
  tblItems.Post ;

end;

procedure TfrmVolitant_Express.btnBackFromGalleryClick(Sender: TObject);
var
  I : integer;
begin
// Go back to the welcome page from the Gallery page
tsGallery.TabVisible := False;

  // Remove any existing dynamic compoents from the group box by freeing them from memory. I used this method in my Grade 11 PAT
  for i := sbGallery.ControlCount - 1 downto 0 do
  begin
    // Check if the control is an Image
    if sbGallery.Controls[i] is tImage then  // Is seems to be used when you are working with components and with shapes
    begin
      // Free the panel from memory and remove it from the parent owning it
      sbGallery.Controls[i].Free;
    end;
  end;


tsWelcome.TabVisible := True;
end;

procedure TfrmVolitant_Express.btnCInfoBackClick(Sender: TObject);
begin
// Go back to the company info reg page from the contact info page
tsContact.TabVisible := false;
tsDetails.TabVisible := True ;
end;

procedure TfrmVolitant_Express.btnCompanyOrderOutClick(Sender: TObject);
var
  sGovernment, sPaid : string;
  bItemFound, bFirst : boolean;
begin
// Displays a list of the companies and the orders that they have places
  redCompanyOut.Clear ;

   bFirst := True;
  tblCompany.First ;
  while not tblCompany.eof do // Loop thru the companies table
  begin
   // Set the tabstops
     redCompanyOut.SelAttributes.Color := clRed;
     redCompanyOut.Paragraph.TabCount := 4;
     redCompanyOut.Paragraph.Tab[0] := 75;
     redCompanyOut.Paragraph.Tab[1] := 225;
     redCompanyOut.Paragraph.Tab[2] := 375;
     redCompanyOut.Paragraph.Tab[3] := 445;
   if bFirst = True then // Display main heading
   begin
       redCompanyOut.Lines.Add('CompanyID'+ #9+ 'Company Name'+ #9+'LocationBased'+#9+ 'Government'+ #9+'Company Age(Years)') ;
       bFirst := False;
   end;

    // Company Info display
    redCompanyOut.SelAttributes.Color := clRed ;
    if tblCompany['Goverment Agency'] = True then
    sGovernment := 'Yes'
    else
    sGovernment := 'No' ;
    redCompanyOut.Lines.Add(#13+inttostr(tblCompany['CompanyID'])+#9+tblCompany['CompanyName']+ #9+tblCompany['Location Based']+ #9+sGovernment+ #9+IntToStr(YearsBetween(Date, tblCompany['Establishment Date']) ) );


     // Setup tabstops for display of orders
    redCompanyOut.SelAttributes.Color := clGreen;
    redCompanyOut.Paragraph.TabCount := 7;
     redCompanyOut.Paragraph.Tab[0] := 65;
      redCompanyOut.Paragraph.Tab[1] := 175;
       redCompanyOut.Paragraph.Tab[2] := 300;
        redCompanyOut.Paragraph.Tab[3] := 450;
         redCompanyOut.Paragraph.Tab[4] := 550;
      redCompanyOut.Paragraph.Tab[5] := 600;
      redCompanyOut.Paragraph.Tab[6] := 690;
     redCompanyOut.Lines.Add('OrderID'+ #9+ 'Weight(kg)'+ #9 + 'Pickup Country'+ #9+'Drop-Off Country'+#9+'Status'+ #9+'Paid'+#9+'Date of Placement'+#9+'Item Name') ;

    // Get the Orders info
    tblOrders.First ;
    while not tblOrders.eof do
    begin

      if tblOrders['CompanyID'] = tblCompany['CompanyID'] then // If a order was found that is listed under the company
      begin

        // Search for the Item that's to get transported in the order
        tblItems.First ;
        bItemFound := False;
        while not tblItems.eof and (bItemFound = False) do
        begin

          if tblOrders['ItemID'] = tblItems['ItemID']  then
          begin
            bItemFound := True;

            if tblOrders['Paid'] = True then
            sPaid := 'Yes'
            else
            sPaid := 'No';

            // Set the display to display the orders info
            redCompanyOut.SelAttributes.Color := clBlack ;
            redCompanyOut.Lines.Add(inttostr(tblOrders['OrderID'])+ #9+ inttostr(tblOrders['weight'])+ #9+ tblOrders['Pickup Country']+#9+ tblOrders['Drop of Country']+#9 +tblOrders['Status']+#9+ sPaid+#9+DateToStr(tblOrders['Order Date'])+#9+tblItems['Item Name']  )   ;


          end;

        tblItems.Next;
        end;

      end;


    tblOrders.Next ;
    end;

    tblCompany.Next;
  end;


end;

procedure TfrmVolitant_Express.btnCustomSQLClick(Sender: TObject);
var
  sSQL : string ;
begin
// Run a custom SQL statement that the user entered in the edit and display in the dbg grid

sSQL := edtCustomSQL.Text;

// Validate that the length is shorter than 255 characters

  if Length(sSQL) > 255  then
  begin
       ShowMessage('Custom SQL statement is to long');
       exit;
  end;

qrySQL.SQL.Text := sSQL ;
qrySQL.Open ;
end;

procedure TfrmVolitant_Express.btnRetireItemClick(Sender: TObject);
begin
// retire an item


end;

procedure TfrmVolitant_Express.btnGalleryClick(Sender: TObject);   // Dynamic Component
const imgWidth = 480;
const imgHeight = 250;
var
  i, iLeft, iTop, iPerLineCount  : integer;
  bOne : boolean;
  tGalleryFile : TextFile ;
begin
// Shows some pictures about the company   (some of this code will have come from my Grade 11 PAT)

  // Create the dynamic components (images) that will be used to display the gallery

  if iImageCount = 0 then // Only read the files into the array ones; the first time the button is clicked
  begin

    // Get the name of the images into an array

    // Read image names from txt file to array
    AssignFile(tGalleryFile, 'Gallery/ImageNames.txt');
    if not FileExists('Gallery/ImageNames.txt')  then
    begin // Create the file if it does not exits
      Rewrite(tGalleryFile) ;
      ShowMessage('Gallery/ImageNames.txt was not found; created')   ;
      exit;
    end;

    Reset(tGalleryFile );
     // Read the file names into the array
    while not (Eof(tGalleryFile ) ) and (iImageCount < 1000) do
    begin
       Inc(iImageCount) ;

       Readln(tGalleryFile , arrFileNames[iImageCount]);
     //  ShowMessage(arrFileNames[imgWidth]);
    end;
    CloseFile(tGalleryFile ) ;
  end;

  // Create the image components and fill them with the images

  iPerLineCount := 0;
  iTop := 20;
  bOne := True;
  for I := 1 to iImageCount do
    begin
      if FileExists('Gallery/'+ arrFileNames[I])  then    // Check that the file can be opened by the system
      begin
    
      // Create the image
        imgDynamicGallery := TImage.Create(Self) ;
        imgDynamicGallery.Width := imgWidth ;
        imgDynamicGallery.Height := imgHeight ;
        
        imgDynamicGallery.OnClick	:= imgDynamicOnclick;

        // The the image
        imgDynamicGallery.Stretch := True;
        imgDynamicGallery.Picture.LoadFromFile('Gallery/'+ arrFileNames[I]) ;

        // Set the images locations

        // Set the position in the horisontal
        if bOne = True then
        begin
          iLeft := 20 ;
          bOne := False;
        end
        else
        begin
          iLeft := sbGallery.Width - 40 - imgWidth	 {iLeft + imgWidth + 40} ;
          bOne := True;
        end;

        Inc(iPerLineCount);

        imgDynamicGallery.Left := iLeft;
        imgDynamicGallery.Top := iTop;

        // Change the POS of the image in the vertical
        if iPerLineCount = 2 then
        begin
          iPerLineCount := 0;
          iTop := iTop + imgHeight+ 25 ;
        end;

        // Set the parent
        imgDynamicGallery.Parent := sbGallery ;
      
      end;
    end;

// go to the gallery tab sheet
tsWelcome.TabVisible := False;
tsGallery.TabVisible := true;

end;

procedure TfrmVolitant_Express.btnIntroVidClick(Sender: TObject);
begin
// Plays the recorded intro video about the company

// go to anotherr tab sheet
tsWelcome.TabVisible := False;
tsIntroVideo.TabVisible := true ;

  mpIntroVideo.FileName := 'Program Media\Intro Video_5.wmv';  // Set the video file path
  mpIntroVideo.Display := pnlVideo;  // Assign the panel as the display window
  mpIntroVideo.Open;  // Open the video file
  mpIntroVideo.Play;  // Play the video
end;

procedure TfrmVolitant_Express.btnLastInfoBackClick(Sender: TObject);
begin
// Go back to the contact info reg page from the last info page
tsLastInfo.TabVisible := False;
tsContact.TabVisible := True;
end;

procedure TfrmVolitant_Express.btnLoginBackClick(Sender: TObject);
begin
// Go back to the welcome page from the login page
tsLogin.TabVisible := false;
tsWelcome.TabVisible := True;
end;

procedure TfrmVolitant_Express.btnLoginClick(Sender: TObject);
begin
// Login to the program

  // Perhaps add SQL Injection protection

  qrySQL.SQL.Text := 'Select CompanyID from tblCompany where (Username = ' + QuotedStr(edtUsernameLogin.Text) + ') and Password = '+ QuotedStr(edtPasswordLogin.Text) ;  // SQL Query

   qrySQL.Open ;

  if not qrySQL.IsEmpty then  // Checks that the field (Query) does not come up empty
  begin
   //  qrySQL.First ;
     sID := inttostr(qrySQL['CompanyID'])  ;

     ShowMessage('Logged in succesfully!');
      // Change the tabsheets
     tsLogin.TabVisible := False;
     tsHome.TabVisible := True ;
  end
  else
  begin  // If it was an invalid login
    Showmessage('Invalid Password or username!') ;
    Exit;
  end;

end;

procedure TfrmVolitant_Express.btnLoginGOClick(Sender: TObject);
begin
// Go to the Login page
tsWelcome.TabVisible :=  false ;
tsLogin.TabVisible := True;
end;

procedure TfrmVolitant_Express.btnManageCompanyClick(Sender: TObject);
begin
// Go to the page to manage company info page from the home page
tsHome.TabVisible := False;
tsManageCompany.TabVisible := true;
end;

procedure TfrmVolitant_Express.btnOrderPhaseAdminClick(Sender: TObject);
begin
// Search and list orders that are in a spesific phase

// Validation
end;

procedure TfrmVolitant_Express.btnPauseVidClick(Sender: TObject);
begin
// Pause the video
mpIntroVideo.Pause ;
end;

procedure TfrmVolitant_Express.btnPlayVidClick(Sender: TObject);
begin
// Play the video if the video was paused
mpIntroVideo.Resume ;
end;

procedure TfrmVolitant_Express.btnRegBackClick(Sender: TObject);
begin
// Go back to the Welcome page from the Register page

  // clear all of the fields

tsRegister.TabVisible := False;
tsWelcome.TabVisible := True ;
end;

procedure TfrmVolitant_Express.btnRegisterGOClick(Sender: TObject);
begin
// Go to the register page
tsWelcome.TabVisible := false ;
tsRegister.TabVisible := True ;
end;

procedure TfrmVolitant_Express.btnRegRestartClick(Sender: TObject);
begin
// Restarts the regestration from the begining, does not clear any fields
chkConfirmRegInfo.Checked := False;
tsRegConfirm.TabVisible := False;
tsDetails.TabVisible := True ;
end;

procedure TfrmVolitant_Express.btnReloadSumClick(Sender: TObject);
const RevenueGoal = 1000000000;
const OrdersGoal = 100;
var
  iNum, iYearlyOrdersGoal : integer ;
  sString : string;
  rRevenue, rHours, rYearlyRevenueGoal : real;
  bFound : boolean;
begin
// Reloads the page; updating the info

 // Total Accounts
 pnlTotalAccounts.Caption := 'Total Accounts: ' + IntToStr(tblCompany.RecordCount); 
 // total Orders
 pnlTotalOrders.Caption :='Total Orders: '+ IntToStr(tblOrders.RecordCount );
 // Total Items
 pnlTotalItems.Caption := 'Total Items: ' + IntToStr(tblItems.RecordCount) ;
 // Total Planes 
 pnlTotalPlanes.Caption := 'Total Planes: ' + IntToStr(tblPlanes.RecordCount) ;

 // Top plain
 qrySQL.SQL.Text := 'SELECT TOP 1 PlaneID AS Result FROM tblOrders Group By PlaneID ORDER BY Count(*) DESC';
  qrySQL.Open ;  
 iNum := qrySQL['Result'];
 qrySQL.SQL.Text := 'Select [Plane Name] as Result from tblPlanes where PlaneID = '+ IntToStr(iNum);
 qrySQL.Open ; 
 sString := qrySQL['Result'];
  lblTopPlain.Caption := 'Top Plain: ' + sString ;

  //  Top Item  
  qrySQL.SQL.Text := 'Select TOP 1 [Item Name] As Result from tblItems, tblOrders where tblOrders.ItemID = tblItems.itemID Group By tblItems.[Item Name] ORDER BY Count(*) DESC'; 
  qrySQL.Open ;
  lblTopItem.Caption := 'Top Item: ' + qrySQL['Result']; 

  // Top Pickup Country
  qrySQL.SQL.Text := 'Select TOP 1 [Pickup Country] as Result from tblOrders Group By [Pickup Country] Order By Count(*) DESC'  ;
   qrySQL.Open ;
   lblTopPickupC.Caption := 'Top Pickup Country: ' + qrySQL['Result'] ;

   // Drop of Country
   qrySQL.SQL.Text := 'Select TOP 1 [Drop of Country] as Result from tblOrders Group By [Drop of Country] Order By Count(*) DESC'  ;
   qrySQL.Open ;
   lblTopDropoffC.Caption := 'Top Drop-Off Country: ' + qrySQL['Result'] ;

   // Total Revenue for all time calculation
   rRevenue := 0 ;
   rYearlyRevenueGoal := 0 ;
   iYearlyOrdersGoal := 0;
   tblOrders.First ;
   while not tblOrders.eof do   // Loop thru tblOrders
   begin
      if tblOrders['Paid'] = true then   // Checks that the order has been paid, before adding it to revenue sum
      begin

        rRevenue := rRevenue + tblOrders['Base Cost'] ; // Add the base cost to total revenue
        tblItems.First ;

        if (YearOF(tblOrders['Pickup Date']) = YearOf(Date))  then // inc the orders that occured this year specificaly counter
        Inc(iYearlyOrdersGoal) ;


        bFound := False;
        while not tblItems.eof and (bFound = false) do // Loop thru items table to get the price for an item per kg
        begin

          if tblItems['ItemID'] = tblOrders['ItemID'] then
          begin
          bFound := true;
            rRevenue := rRevenue + tblItems['T_Cost/kg'] * tblOrders['Weight'] ;

             if (YearOF(tblOrders['Pickup Date']) = YearOf(Date))  then  // increase the revenue that was made this year only
             rYearlyRevenueGoal := rYearlyRevenueGoal +  tblItems['T_Cost/kg'] * tblOrders['Weight'] ;
          end;

          tblItems.Next ;
        end;
        bFound := False;
        // Loop thru plane table to get feul price

        tblPlanes.First;
        while not tblPlanes.Eof and (bFound = false) do
        begin
           if tblPlanes['PlaneID'] = tblOrders['PlaneID'] then
           begin
              bFound := True;
              // Calculate the hours that the flight will last
              rHours  := (tblOrders['E/D Date'] - tblOrders['Pickup Date']) * 24 ; // Get the difference in time and convert it to hours
              rRevenue := rRevenue + tblPlanes['FuelCost']  * rHours  ; // times by the hours of the flight

                 if (YearOF(tblOrders['Pickup Date']) = YearOf(Date))  then  // increase the revenue that was made this year only
             rYearlyRevenueGoal := rYearlyRevenueGoal +  tblPlanes['FuelCost']  * rHours  ;
           end;

          tblPlanes.Next ;
        end;
      
      end;
      tblOrders.Next ;
   end;
   lblTotalRevenue.Caption := 'Total Revenue: ' + FloatToStrF(rRevenue , ffCurrency ,10,2)  ;

   // Average Order Weight
    qrySQL.SQL.Text := 'Select AVG(Weight) as Result from tblOrders'  ;
   qrySQL.Open ;
   lblAverageWeight.Caption := 'Average Order Weight: ' + floattostrf((qrySQL['Result']), ffFixed, 10,2) + ' kg';
   
  // Set the progress bars for the yearly goals

  // For revenue goal
  PBrevenue.Min := 0;
  PBrevenue.Max := 100;

PBrevenue.Position := Floor(rYearlyRevenueGoal / RevenueGoal* 100 ) ;



  // For the order goal
  PBOrders.Min := 0 ;
  PBOrders.Max := 100;
PBOrders.Position := Floor(iYearlyOrdersGoal / OrdersGoal *100);
end;

procedure TfrmVolitant_Express.btnRestartVidClick(Sender: TObject);
begin
// Restart the video if it played fully or go to the beginnign of the video at any time
mpIntroVideo.Stop;     // Stop the video
mpIntroVideo.Position := 0; // Sets the video's time to the begining
mpIntroVideo.Play;     // Restart the video
end;

procedure TfrmVolitant_Express.btnSendNewsletterClick(Sender: TObject);
begin
// Send the newsletter
end;

procedure TfrmVolitant_Express.btnToCustomClick(Sender: TObject);
var
  sCustomPagePass : string;
begin
// Go to the custom SQL page, ask for a special password to gain access to this part of the website

  sCustomPagePass := IntToStr(RandomRange(1000, 10000) )  ;

  if sCustomPagePass = InputBox('Enter Password to access Custom SQL page', 'The Custom Passowd is: (For PAT purposes it is given)', sCustomPagePass)  then
  begin
   pgcAdmin.ActivePage.TabVisible := False;
   tsCustomAdmin.TabVisible := True;
  end
  else
  begin
    ShowMessage('You got the Password WRONG') ;
   Exit;
  end;

end;

procedure TfrmVolitant_Express.btnToEmailsClick(Sender: TObject);
begin
// Go to the admin email page from any of the other pages
pgcAdmin.ActivePage.TabVisible := False;
tsEmailsAdmin.TabVisible := True;
end;

procedure TfrmVolitant_Express.btnToItemsClick(Sender: TObject);
begin
 // Go to the Items page from any of the other pages
 pgcAdmin.ActivePage.TabVisible := False;
 tsItemsAdmin.TabVisible := True;

   if not FileExists('Item_Categories.txt')  then
  begin
    ShowMessage('Item_Categories.txt not Found. Add categories to resolve this problem');
    Exit;
  end;

 cmbItemCategoryAdd.Items.LoadFromFile('Item_Categories.txt') ;
end;

procedure TfrmVolitant_Express.btnTOLogClick(Sender: TObject);
begin
// Go to the page to View logs page from the home page
tsHome.TabVisible := False;
tsLog.TabVisible := True ;
end;

procedure TfrmVolitant_Express.btnTOorderClick(Sender: TObject);
begin
// Go to the page to place an order for a transport from the home page
tsHome.TabVisible := False;
tsPOrder.TabVisible := True ;
end;



procedure TfrmVolitant_Express.btnToOrdersOutputClick(Sender: TObject);
begin
// Go to the orders output page from the orders update page
end;

procedure TfrmVolitant_Express.btnTOorderUpdateClick(Sender: TObject);
begin
// Go to the update orders page from the order output page

end;

procedure TfrmVolitant_Express.btnTOpaymentClick(Sender: TObject);
begin
// Go to the page to manage payments page from the home page
tsHome.TabVisible := False;
tsPayment.TabVisible := True ;


end;

procedure TfrmVolitant_Express.btnToSummaryClick(Sender: TObject);
begin
// Go to the summary page and load the info on the page
  pgcAdmin.ActivePage.TabVisible := false;
  tsAdminSum.TabVisible := True;
  btnReloadSum.Click  ;
end;

procedure TfrmVolitant_Express.btnUpdateItemClick(Sender: TObject);
begin
// Update the item

// Validation
end;

procedure TfrmVolitant_Express.btnUpdatePlaneClick(Sender: TObject);
begin
// Update the plane info

// Validation

// if the retire plane button was selected, display a confirmation dialogue to confirm that they want to retire the plane
end;

procedure TfrmVolitant_Express.Button1Click(Sender: TObject);
var
  tFlightHours : integer;
  rHours : real;
begin
 tFlightHours := HoursBetween(tblOrders['Pickup Date'], tblOrders['E/D Date']) ;
              //rRevenue := rRevenue + tblPlanes['FuelCost']  * tFlightHours ; // times by the hours of the flight
      // rHours := (tblOrders['E/D Date'] - tblOrders['Pickup Date']) * 24;  // TDateTime difference * 24
          rHours  := HoursBetween(tblOrders['Pickup Date'], tblOrders['E/D Date']) ;
    ShowMessage(FloatToStr(rHours) ) ;
 ShowMessage(intToStr(tFlightHours) ) ;
end;

procedure TfrmVolitant_Express.cmbCountryBasedChange(Sender: TObject);
var
  sFileName, sCountryName : string;
  I: Integer;
begin
// Display the flag of the selected Based country in the image component

  if cmbCountryBased.ItemIndex >=0 then // Make sure than an option was selected
  begin
    sFileName := 'Flags/' + arrCountryCode[cmbCountryBased.ItemIndex+1] + '.jpg';  // Create the name of the file to open
    if FileExists(sFileName) then
    imgBasedFlag.Picture.LoadFromFile(sFileName) // Load the image
    else
    imgBasedFlag.Picture.LoadFromFile('Flags/Not_Found.jpg') ;    // If, for some reason, The file cannot be found, display not found
  end
  else
   imgBasedFlag.Picture.LoadFromFile('Flags/Not_Found.jpg') ; // If no valid images was selected

end;

procedure TfrmVolitant_Express.cmbSelectTableChange(Sender: TObject);
begin
// Change the table being displayed in dbgDifferentTable

  case cmbSelectTable.ItemIndex of             // Set a data source to be active in the table
  0: dbgDifferentTables.DataSource := dsrOrders ;
  1: dbgDifferentTables.DataSource := dsrPlanes ;
  2: dbgDifferentTables.DataSource := dsrCompany ;
  3: dbgDifferentTables.DataSource := dsrItems ;
  end;
end;

procedure TfrmVolitant_Express.dbgDifferentTablesCellClick(Column: TColumn);
begin
// If the active table is tblOrders: when a record is clicked on: Retrieve all the foreign data from the other tables and dispay info about that record in a showmessage
end;

procedure TfrmVolitant_Express.FormActivate(Sender: TObject);
var
  tFile : TextFile ;
  sLine, sKeep : string ;
  iPos : integer ;
  I, k: Integer;
  rKeep : real;

begin
// Form Acticvate
iCountryCount := 0 ;
sID := '';


// array population

    // Populate the arrays containing the countries info
    if not FileExists('Country_Coordinates.txt')  then
    begin
      ShowMessage('Country_Coordinates.txt was not found!  Create a new Country_Coordinates.txt file that does not have more than 245 countries and has the format of CountryCode#Latitude#Longitude#CountryName');
      Exit;
    end
    else
    begin
      AssignFile(tFile, 'Country_Coordinates.txt')  ;
      Reset(tFile);

      while not Eof(tFile) and (iCountryCount < 245)  do
      begin
        Inc(iCountryCount);
        Readln(tFile, sLine) ;
         //arrCountryCode
        iPos := Pos('#', Sline);
        arrCountryCode[iCountryCount] := Copy(sLine, 1, iPos-1 ) ;
        Delete(sLine, 1 , iPos);
         //arrLatitude
         iPos := Pos('#', Sline);
        arrlatitude[iCountryCount] := (StrToFloat(Copy(sLine, 1, iPos-1 )) * (pi/ 180)) ;
        Delete(sLine, 1 , iPos);
        //arrLongitude
         iPos := Pos('#', Sline);
        arrLongitude[iCountryCount] := (strToFloat(Copy(sLine, 1, iPos-1 )) * (pi/ 180)) ;
        Delete(sLine, 1 , iPos);
        //CountryName
        arrCountryName[iCountryCount] := sLine ;

      // ShowMessage(IntToStr(iCountryCount) );
      end;

      CloseFile(tFile) ;


    end;

    // Sort the country arrays alpabetically from A to Z
    for I := 1 to iCountryCount -1 do
      for k := I+1 to iCountryCount do
      begin
        if UpperCase(arrCountryName[k]) < UpperCase(arrCountryName[i])   then
        begin
          // arrCountryName
          sKeep := arrCountryName[I];
          arrCountryName[I] := arrCountryName[k] ;
          arrCountryName[k] := skeep;
          // arrCountryCode
           sKeep := arrCountryCode[I];
          arrCountryCode[I] := arrCountryCode[k] ;
          arrCountryCode[k] := skeep;
          // arrLongitude
          rKeep := arrLongitude[I];
          arrLongitude[I] := arrLongitude[k];
          arrLongitude[k] := rKeep;
          //arrLatitude
          rKeep := arrLatitude[i];
          arrLatitude[i] := arrLatitude[k];
          arrLatitude[k] := rKeep;

        end;
      end;

    // Load the countries into selection boxes
    cmbCountryBased.Clear ; // Clears any txt that may have been in the comboBox
    for I := 1 to iCountryCount do
    cmbCountryBased.Items.Add(arrCountryName[i]) ;


    // Special character array
      iSpecialCharacterCount := 0;
    
     if not FileExists('Special_Characters.txt')  then
      begin
        ShowMessage('Special_characters.txt not found. Create a new one with no more than 32 characters') ;
        Exit ;
      end
      else
      begin
        AssignFile(tFile, 'Special_Characters.txt');
        Reset(tFile) ;

        while not Eof(tFile) and (iSpecialCharacterCount < 32) do
        begin
           Inc(iSpecialCharacterCount); 

           Readln(tFile, arrSpecialCharacters[iSpecialCharacterCount] ) ;
        end;
       
        CloseFile(tFile) ;
      end;

  if bTimer = false then // Only set this on the first time the activation code runs
  begin

  // Run the plane animation
  imgPlaneAnimation.Stretch := True;
  imgPlaneAnimation.Picture.LoadFromFile('Program Media/airplane-side-view-travel-passenger-commercial-vector-15881171.jpg') ;
  imgPlaneAnimation.Left := 0 ;

  {       // This is code from my grade 10 PAT
    ProgressValue := 0;
  ProgressBarStartUp.Min := 0;
  ProgressBarStartUp.Max := 1000;
  ProgressBarStartUp.Position := ProgressValue;   }

  // Set the timers properties
  tFlightAnimation.Interval := 250; // 1000 milliseconds (1 second)
  tFlightAnimation.Enabled := True;
    //  Countdown := 5  ;

  bTimer := true ;
  end;

    

// Database Connection

  conDB.Connected := False ;
  conDB.LoginPrompt := False ;

  conDB.ConnectionString := 'Provider=Microsoft.Jet.OLEDB.4.0;Data Source=Volitant_Express_db.mdb;Mode=ReadWrite;Persist Security Info=False' ;

  conDB.Open;


  // SQL Query connection

  qrySQL.Connection := conDB ;

  dsrSQL.DataSet := qrySQL ;

  dbgSQL_admin.DataSource := dsrSQL ;


  // tblCompany    DO this for every table

  tblCompany.Connection := conDB ;
  tblCompany.TableName := 'tblCompany';
  tblCompany.Active := True;

  dsrCompany.DataSet := tblCompany ;

 // dbgtest.datasource := dsrCompany ;

 //tblOrders

  tblOrders.Connection := conDB ;
  tblOrders.TableName := 'tblOrders';
  tblOrders.Active := True;

  dsrOrders.DataSet := tblOrders ;

//  dbgtest.datasource := dsrOrders  ;

  // tblItems

  tblItems.Connection := conDB ;
  tblItems.TableName := 'tblItems';
  tblItems.Active := True;

  dsrItems.DataSet := tblItems ;

//  dbgtest.datasource := dsrItems  ;

  // tblPlanes

  tblPlanes.Connection := conDB ;
  tblPlanes.TableName := 'tblPlanes';
  tblPlanes.Active := True;

  dsrPlanes.DataSet := tblPlanes ;

//dbgtest.datasource := dsrPlanes  ;

end;

procedure TfrmVolitant_Express.FormCreate(Sender: TObject);
begin
// Set up the tab sheets
{
tsRegister.TabVisible := False;
tsLogin.TabVisible := False;
tsIntroVideo.TabVisible := False;
tsGallery.TabVisible := False;
}
      {                              // Dont add the sum page to list, will cause errors due to activepage.tabvisible
  tsItemsAdmin.TabVisible := False;
  tsPlanesAdmin.TabVisible := False;
  tsOrdersAdmin.TabVisible := False;
  tsCompaniesAdmin.TabVisible := False;
  tsEmailsAdmin.TabVisible := False;
  tsCustomAdmin.TabVisible := False;
               }

  tsContact.TabVisible := False;
  tsLastInfo.TabVisible := False;
  tsRegConfirm.TabVisible := False;

  // Set sonme starting variablles
  bTimer := False;
  iImageCount := 0;
end;




procedure TfrmVolitant_Express.imgDynamicOnclick;
var
  sString : string;
begin
// Onclick for the dynamic images. Display something positive stat wise about volitant express

  case RandomRange(1,6)  of      // When an image is clicked, a random message with stats wil be displayed 
  1: begin     // Count how many successfull orders has taken place
      qrySQL.SQL.Text := 'Select Count(*) as Result from tblOrders where status = "Delivered"';
      qrySQL.open;
       sString := (inttostr(qrySQL['Result']))  ;
       ShowMessage('Total successfull orders: '+sString) ;
    end;
    
  2: begin  // Count how many active planes the company have
       qrySQL.SQL.Text := 'Select Count(*) as Result from tblPlanes where Retired = NO';
      qrySQL.open;
       sString := (inttostr(qrySQL['Result']))  ;
       ShowMessage('Total Active Planes: ' + sString ) ; 
    end;
  3:     
    begin // Count how many items are currently shipped by Volitant Express
       qrySQL.SQL.Text := 'Select Count(*) as Result from tblItems where Retired = NO';
      qrySQL.open;
       sString := (inttostr(qrySQL['Result']))  ;
       ShowMessage('We currently transport '+ sString + ' different items') ;
    end;
  4:
    begin // Count how many companies are customers
         qrySQL.SQL.Text := 'Select Count(*) as Result from tblCompany';
      qrySQL.open;
       sString := (inttostr(qrySQL['Result']))  ;
       ShowMessage(sString +' companies trust us to transport their goods from locations around the world') ;
    end;
  5:
    begin  // Display the country with the most Companies as customers of Volitant Express
        qrySQL.SQL.Text := 'Select TOP 1 [Location Based] as Result from tblCompany Group By [Location Based] ORDER BY COUNT(*) DESC';
      qrySQL.open;
       sString := ((qrySQL['Result']))  ;
       ShowMessage('Most of our Customer Companies are based in: '+ sString ) ;
    end;
  end;

end;

procedure TfrmVolitant_Express.lstSelectItemManageClick(Sender: TObject);
begin
// Update the Update components
end;

procedure TfrmVolitant_Express.tFlightAnimationTimer(Sender: TObject);
begin
 // Timer code
 // Change the image location
 imgPlaneAnimation.Left := imgPlaneAnimation.Left + 30;

 if imgPlaneAnimation.Left > 1100 then
 imgPlaneAnimation.Left := 0 ;
end;

function TfrmVolitant_Express.ValidateEmail(pEmail: string): Boolean;
var
  sEmail : string ; 
  I, iPointPos, iATcount : integer ;
  bPoint: boolean;
begin
// Function to validatate an email address
// Returns a true in the end if the email is valid
   sEmail := pEmail;
    // Checks that an email was entered
  if (sEmail = '') or (sEmail = ' ') then
  begin
    ShowMessage('Please enter an email address');
    Result := False;
    exit;
  end;
  // Checks that the email is in a certain range 
  if Length(sEmail) > 70  then
  begin
    ShowMessage('Email must be 70 characters or shorter') ;
      Result := False;
    Exit;
  end;

     // ensures that the email does not start with a dot
    if sEmail[1] = '.' then
    begin
      ShowMessage('Email may not start with a .');
        Result := False;
      exit; 
    end;
    
    // Checks that there are no spaces in the email
  if Pos(' ', sEmail) > 0  then
  begin
    ShowMessage('No spaces are allowed in the email');
      Result := False;
    exit; 
  end;
  
  iATcount := 0;
    // Check that the email contains valid characters
  for I := 1 to Length(sEmail)  do
    begin
      if not (sEmail[I] in ['A'..'Z', 'a'..'z', '@', '.', '0'..'9']) then
      begin
        ShowMessage('Invalid characters in email');
          Result := False;
        exit; 
      end;

      if sEmail[i] = '@' then
      Inc(iATcount)  ;
      
    end;

  // Checks that there is an @ in the email
  if not (iATcount  = 1) then
  begin
    ShowMessage('Email must have 1 @ only');
      Result := False;
    exit; 
  end;

  // Checks that there is a . after the @ in the email
  bPoint := False ;
  iPointPos := 0;
   for I := Length(sEmail)  Downto Pos('@', sEmail)  do
   begin
      if sEmail[i]= '.' then
      begin
        bPoint := True ;
        iPointPos := I ;
        Break;
      end;
      
   end;
     
   if bPoint = False then
   begin
     ShowMessage('Enter a valid domain after the @ (.)')  ;
       Result := False;
     Exit ;
   end
   else
   begin
      if ( (iPointPos = Length(sEmail) )) then // ensures that the last character is not a dot
      begin
        ShowMessage('Enter a valid domain after the @');
          Result := False;
        exit;
      end;
      // ensures that there is something after a dot 
      if not (sEmail[iPointPos+1] in ['A'..'Z', 'a'..'z']) then
      begin
          ShowMessage('Enter a valid domain after the @ ()');
            Result := False;
        exit;
      end;
      
      for I := 1 to Length(sEmail)-1  do
        begin
          if ((sEmail[I] = '.') and (sEmail[I+1] = '.')) then // Checks that there are not double dots in the email
          begin
            ShowMessage('No double dots allowed in email');
              Result := False;
            exit;
          end;
          // ensures that there is not a . directly agaist the @ in the email
          if ((sEmail[I] = '.') and (sEmail[I+1] = '@')) or ((sEmail[I] = '@') and (sEmail[I+1] = '.')) then
          begin
            ShowMessage('Enter a valid email. There must be things between the dot and the @');
              Result := False;
            exit; 
          end;
          
        end;
   end;

    Result := True;
  
end;

end.
// THE END OF THE FILE :)